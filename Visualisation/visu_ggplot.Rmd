---
title: "Graphics and maps with R"
subtitle: "<br/>Under Hadley Wickham's reign"
author: "Marie-Pierre Etienne"
date: '2020/09/11 (updated: `r Sys.Date()`)'
institute: https://github.com/MarieEtienne/stateoftheRinRennes/
csl: ../resources/apa-no-doi-no-issue.csl
output:
  xaringan::moon_reader:
    css: [  'metropolis', 'hygge', 'mpe_pres.css']
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:10
    includes:
      after_body: insert-logo.html
bibliography: visu.bib
fontsize: 10pt
params:
  child_path: ''
  setup_path: ../resources/
---

```{r setup,   cahe = FALSE, eval = TRUE, echo = FALSE, message = FALSE}
source(paste0(params$setup_path, "knitr_setup.R"))
with_sol <- TRUE ## in order to control the output
with_course <- TRUE
```

```{r,  include=FALSE, cache=FALSE, eval = TRUE}
library(kableExtra)
library(flipbookr)
```


# Introduction

---

# Tutorial based on

- [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/index.html) @wickham2016ggplot2
- [Geocomputation with R](https://geocompr.robinlovelace.net/) @lovelace2019geocomputation`
- [Tutoriel de Raphaelle Momal et Marie Perrot Dockes](https://stateofther.github.io/post/fancy-plotting/)
- [Drawing beautiful maps programmatically with R](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html)



<!-- --- -->


<!-- # ggplot presentation -->

<!-- gg stands for   *Grammar of Graphics*  and  ggplot2  is *based on the Grammar of Graphics @wilkinson2005gramma`, that allows you to compose graphs by combining independent components* (@wickham2016ggplot2). -->

<!-- *[The] grammar tells us that a graphic maps the data to the aesthetic attributes (colour, shape, size) of geometric objects (points, lines, bars). The plot may also include statistical transformations of the data and information about the plot’s coordinate system. Facetting can be used to plot for different subsets of the data. The combination of these independent components are what make up a graphic.*  (@wickham2016ggplot2). -->


<!-- For coherence, we will make use of the `tidyverse` suite. -->


---


# First running example:  The Palmer Penguins dataset


```{r load_tidyverse, message = FALSE, eval = TRUE, echo = TRUE}
library(tidyverse)
```

```{r palmer_data, eval = TRUE, echo = TRUE}
#remotes::install_github("allisonhorst/palmerpenguins")
data(penguins,package = "palmerpenguins")
penguins <- penguins %>%
  rename(bill_l = bill_length_mm, bill_d = bill_depth_mm, flip_l = flipper_length_mm, bm = body_mass_g)
penguins %>%
  print(n=2)
```


---

# The Palmer Penguins dataset : overview


```{r show_data_palmer, eval = TRUE, echo = TRUE}

penguins %>%
  group_by(species, sex, year, island) %>%
  mutate(n = n()) %>%
  summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  print(n=10)
```


---
 
# Simple plots 

---
 
# A scatter plot

```{r simple_scatter}
penguins %>% 
  ggplot() + 
  aes( x= bill_l, y=bill_d) + 
  geom_point()
```

---

`r chunk_reveal("simple_scatter", break_type = "auto")`

---

# A scatter plot
 
## with colors 

```{r scatter_plot_species}
penguins %>% 
  ggplot() +
  aes( x= bill_l, y=bill_d) +
  geom_point() + #BREAK
  aes(col = species)  #BREAK
```

---

`r chunk_reveal("scatter_plot_species", break_type = "user")`

---

# A scatter plot

## with a color blind compliant palette


```{r gg1_save, eval = TRUE, echo = TRUE}
gg <- penguins %>% 
  ggplot() +
  aes( x= bill_l, y=bill_d) +
  geom_point() + 
  aes(col = species)  
```


---

```{r scatter_viridis}
gg + 
  scale_color_viridis_d()
```

`r chunk_reveal("scatter_viridis", break_type = "auto")`

---

# A scatter plot

##  with a color tribute to [Wes Anderson](https://en.wikipedia.org/wiki/Wes_Anderson) 

Following  a Tumblr blog  [Wes Anderson Palettes](https://wesandersonpalettes.tumblr.com/), Karthik Ram proposes the [wesanderson palette](https://github.com/karthik/wesanderson) on Github.

---

```{r scatter_wesanderson}
## remotes::install_github("wesanderson")
color_darj <- wesanderson::wes_palette(name = "Darjeeling1")
gg + 
  scale_color_manual(values = color_darj)
```


`r chunk_reveal("scatter_wesanderson", break_type = "auto")`

---


# A scatter plot

##  with a color tribute to [Wes Anderson](https://en.wikipedia.org/wiki/Wes_Anderson) 

## with nice labels

```{r scatter_labels_gg, eval = TRUE, echo = TRUE}
color_darj <- wesanderson::wes_palette(name = "Darjeeling1")
gg <- gg + scale_color_manual(values = color_darj) 
```


---

```{r scatter_labels}
gg  +
  labs( x = 'Bill length in mm') +
  labs(y = 'Bill depth in mm') +
  labs(color = "Species")
```

`r chunk_reveal("scatter_labels", break_type = "auto")`

---

<!-- ### Pre set general theme -->

<!-- ```{r scatter_themelight} -->
<!-- gg <- gg + scale_color_manual(values = color_darj) + -->
<!--   labs( x = 'Bill length in mm',  y = 'Bill depth in mm',  color = "Species") + -->
<!--   theme_light() -->
<!-- gg -->
<!-- ``` -->

<!-- ### Pre set general theme -->

<!-- ```{r scatter_thememinimal} -->
<!-- gg + scale_color_manual(values = color_darj) + -->
<!--   labs( x = 'Bill length in mm',  y = 'Bill depth in mm',  color = "Species") + -->
<!--   theme_minimal() -->
<!-- ``` -->


<!-- ### Changing legend position -->

<!-- The default theme might not be the best option -->

<!-- ```{r scatter_below} -->
<!-- gg + theme(legend.position="bottom") -->
<!-- ``` -->

<!-- ### Customed legend position -->

<!-- The legend position can also be specified by a vector ` c(x,y)`.  Their values should be between 0 and 1. c(0,0) corresponds to the “bottom left” and c(1,1) corresponds to the “top right” position. We may want to change the size. -->

<!-- ```{r scatter_within} -->
<!-- library(extrafont) -->
<!-- loadfonts() -->
<!-- gg + theme(legend.position=c(.9, .6)) -->
<!-- ``` -->

<!-- ### Customizde theme -->

<!-- ```{r scatter_custom} -->
<!-- ## install.packages('extrafont') -->
<!-- library(extrafont) -->
<!-- ## font_import() # just run once after installation -->
<!-- loadfonts() -->
<!-- gg + theme(legend.position=c(.9, .6), -->
<!--            text = element_text(size = 8, face = "italic"), -->
<!--            axis.text.x = element_text(angle=90, hjust=1), -->
<!--            legend.text = element_text(size = 9, face = 'plain'), -->
<!--            legend.title = element_text(size = 10, face = "bold") ) -->

<!-- ``` -->


<!-- ### Adding statistical transformation -->

<!-- Adding a fitted linear regression -->

<!-- ```{r stat_info_lm} -->
<!-- gg + geom_smooth(method = 'lm', se = FALSE) -->
<!-- ``` -->


<!-- ### Adding statistical transformation -->

<!-- Adding a fitted loess regression  with standaer estimation error -->

<!-- ```{r stat_info} -->
<!-- gg + geom_smooth(method = 'loess', se = TRUE) -->
<!-- ``` -->



<!-- ## Other geometries -->

<!-- ### Histogram -->

<!-- ```{r simple_hist} -->

<!-- penguins %>% -->
<!--   ggplot() + aes(x = bill_l) + geom_histogram() + -->
<!--   labs( x = 'Bill length in mm') + -->
<!--   theme_minimal() -->

<!-- ``` -->


<!-- ### Histogram - exercise -->

<!-- Add the color according to species and use the `GrandBudapest1` palette from `wesanderson` package. -->

<!-- ```{r color_hist,   echo = TRUE} -->

<!-- penguins %>%  ... -->
<!-- ``` -->



<!-- ### Histogram - exercise -->

<!-- ```{r color_hist_cor} -->

<!-- penguins %>% -->
<!--   ggplot() + aes(x = bill_l, fill = species) + geom_histogram() + -->
<!--   labs( x = 'Bill length in mm') + -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('GrandBudapest1', n = 3)) + -->
<!--   theme_minimal() -->
<!-- ``` -->


<!-- ### Split in 3 histograms -->

<!-- ```{r color_hist_facet} -->

<!-- penguins %>% -->
<!--   ggplot() + aes(x = bill_l, fill = species) + -->
<!--   facet_wrap(~species) + geom_histogram() + -->
<!--   labs( x = 'Bill length in mm') + -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('Darjeeling1')) + -->
<!--   theme_minimal() -->
<!-- ``` -->

<!-- ### Split in 3 histograms  with fitted densities -->

<!-- Change the previous graph to add a fitted density line -->

<!-- ```{r color_hist_dens_ex, eval = FALSE} -->

<!-- penguins %>% ... -->
<!-- ``` -->


<!-- ### Split in 3 histograms  with fitted densities -->

<!-- Change the previous graph to add a fitted density line -->

<!-- ```{r color_hist_dens_cor} -->

<!--  penguins %>%  ggplot() + aes(x = bill_l, y = ..density..) + -->
<!--   facet_wrap(~species) + geom_histogram(alpha=0.5, aes( fill = species)) + -->
<!--    geom_density(aes(col = species)) + -->
<!--   labs( x = 'Bill length in mm') + -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('Darjeeling1')) + -->
<!--   scale_color_manual(values = wesanderson::wes_palette('Darjeeling1')) + -->
<!--   theme_minimal() -->
<!-- ``` -->



<!-- ## Useful and/or fancy packages -->


<!-- ### For publications -->

<!-- The `ggpubr' package is very helpful for publication. -->

<!-- ```{r ggpubr_p1} -->
<!-- gg_p1 <- gg -->
<!-- gg_p1 -->
<!-- ``` -->

<!-- ### For publications -->

<!-- The `ggpubr' package is very helpful for publication. -->

<!-- ```{r ggpubr_p2} -->
<!-- gg_p2 <- penguins %>% -->
<!--   ggplot()  + aes(x = bill_l, y = ..density..) + geom_histogram(alpha=0.5, aes( fill = species)) + -->
<!--    geom_density(aes(col = species)) + -->
<!--   labs( x = 'Bill length in mm') + -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('Darjeeling1')) + -->
<!--   scale_color_manual(values = wesanderson::wes_palette('Darjeeling1')) + -->
<!--   theme_minimal() -->
<!-- gg_p2 -->
<!-- ``` -->


<!-- ### For publications -->

<!-- The `ggpubr' package is very helpful for publication. -->

<!-- ```{r ggpubr_p3} -->
<!-- ##install.packages('ggpubr') -->
<!-- ggpubr::ggarrange(gg_p1, gg_p2, nrow=2, ncol = 1) -->
<!-- ``` -->

<!-- ### For publications -->

<!-- The `ggpubr' package is very helpful for publication. -->

<!-- ```{r ggpubr_p4} -->
<!-- ggpubr::ggarrange(gg_p1, gg_p2, nrow=2, ncol = 1, common.legend = TRUE) -->
<!-- ``` -->

<!-- ### For bivaraite exploration -->
<!-- ```{r ggpairs} -->
<!-- ##install.packages('GGally') -->
<!-- library(GGally) -->
<!-- penguins %>% ggpairs(columns = c(1,3,4,5), mapping = aes(col = species)) + -->
<!--   scale_color_manual(values = wesanderson::wes_palette('Darjeeling1'))+ -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('Darjeeling1')) + theme(text = element_text(size = 6)) -->
<!-- ``` -->


<!-- ### For bivaraite exploration and nice looking options -->
<!-- ```{r ggpairs_fancy} -->
<!-- penguins %>% ggpairs(columns = c(1,3,4,5), mapping = aes(col = species), -->
<!--                      upper = list(continuous = wrap( "cor",size = 2)), -->
<!--                      lower = list(continuous = wrap('points', size = .5))) + -->
<!--   scale_color_manual(values = wesanderson::wes_palette('Darjeeling1'))+ -->
<!--   scale_fill_manual(values = wesanderson::wes_palette('Darjeeling1')) + theme(text = element_text(size = 6)) -->
<!-- ``` -->


---

# For presentation - `gganimate`

```{r ani_final, eval = T, echo = T, fig.height=5, fig.width=4}
library(gganimate)
gg  +    
  transition_time(year)  +
  geom_text(x = 56 , y = 15,  
            aes(label = as.character(year)), 
            size = 8, col = "grey50")
```
 




---

# References
