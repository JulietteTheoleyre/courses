---
title: Analyse de la variance
subtitle: à 1 facteur
author: Marie-Pierre Etienne
date: '2020/09/11 (updated: `r Sys.Date()`)'
institute: https://github.com/marieetienne
csl: ../resources/apa-no-doi-no-issue.csl
output:
  xaringan::moon_reader:
    css: [  'metropolis', 'hygge', 'mpe_pres.css']
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: '../resources/collapseoutput.js'
    includes:
      after_body: '../resources/insert-logo.html'
fontsize: 10pt
params:
  child_path: ''
  setup_path: ../resources/
---



```{r setup, include=FALSE, eval = TRUE}
source(paste0(params$setup_path, "knitr_setup.R"))
with_sol <- TRUE ## in order to control the output
with_course <- TRUE
library('flipbookr')
library(RefManageR)
library(tidyverse)
library(ggplot2)
```


```{r reference,  include=FALSE, cache=FALSE, eval = TRUE}
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "alphabetic",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("./lm.bib", check = FALSE)
```

name: intro
# Introduction

---
template: intro
## Un exemple jouet à but pédagogique

On a mesuré la fréquence cardiaque de 20 femmes et 20 hommes.


```{r datapackage, eval = TRUE, echo = FALSE, warning = FALSE}
#remotes::install_github('MarieEtienne/coursesdata', force = TRUE)
```

```{r freqdata, eval = TRUE, echo = TRUE, warning = FALSE}
library(coursesdata)
data(freqdata)
freqdata %>% ggplot() + geom_boxplot(aes(x= Sexe, y = freqC))
```


--
<p class="question"> Les hommes et les femmes ont-ils la même fréquence cardiaque au repos ?</p>

---
template: intro
## Cas d'étude Chauve souris

- Des espèces avec différents régimes alimentaires.
- L'écho localisation (capacité auditive) est un sens essentiel pour les insectivores.

`r Citet(myBib, "hutcheon2002comparative")` ont recensé pour 63 espèces de chauves souris l'espèce, le régime alimentaire, le clade (groupe dans l'arbre phylogénétique), différentes variables morphologiques dont le volume du cerveau dédié à l'audition (AUD)

```{r batsdata, eval = TRUE, echo = FALSE}
data(bats)
bats %>% ggplot() + aes(x= as.factor(Diet), y = AUD) +geom_boxplot(aes(col = as.factor(Diet), fill = as.factor(Diet)), alpha = 0.5) + 
  geom_jitter(size=0.8, alpha=0.7, width = 0.15, aes(col = as.factor(Diet))) + scale_color_manual(values = wesanderson::wes_palette(name = "Darjeeling1")) + scale_fill_manual(values = wesanderson::wes_palette(name = "Darjeeling1")) + theme(legend.position = 'none') + xlab('Diet')
```

--
<p class="question"> Le volume de la partie auditive du cerveau est il lié au régime alimentaire ?</p>

---
template: intro
## Cadre général du modèle d'analyse de la variance à 1 facteur
On étudie le lien entre  
- variable quantitative notée $Y$ (la fréquence cardiaque, volume de cerveau),
- et une variable qualitative (un facteur) pourvant prendre $I$ modalités (I=2 pour l'exemple 1 et I=4 dans l'exemple 2). 


Les données peuvent être visualisées à l'aide d'un boxplot.


--
<p class="question"> La variable d'intérêt Y  est-elle en moyenne différente selon les différentes modalités ?</p>



---
name: model
# Le modèle d'analyse de la variance à 1 facteur

---
name: model
# Le modèle d'analyse de la variance à 1 facteur

## Graphiquement 

```{r anova_versiongraphique}
I <- 3
mu <- round(5 * rnorm(I))
effectif <- runif(n = I, min = 10, max = 30)
fake_dta <- tibble( groupe = rep(1:I, effectif)) %>% group_by(groupe) %>% 
  mutate(y = round(rnorm(n(), mean = mu[groupe], sd = 1.5),2) ) %>% mutate(groupe = as.factor(groupe), ord=0)  
norm_dta <- tibble( x  = seq( min(mu) -3*1.5, max(mu)+ 3* 1.5, length.out = 100))  %>% 
  mutate(d1 = dnorm(x, mean = mu[1], sd = 1.5),
         d2 = dnorm(x, mean = mu[2], sd = 1.5),
         d3 = dnorm(x, mean = mu[3], sd = 1.5)
  ) %>% 
  pivot_longer(cols = starts_with("d"), names_to = 'Groupe', values_to ='density' )%>% 
  mutate(groupe = as.factor(as.numeric(as.factor(Groupe))))

ggplot() + theme(legend.position = 'none') + labs(col = 'Groupe') + geom_line(data = norm_dta, aes(x= x, y = density, col = groupe)) +  scale_color_manual(values = wesanderson::wes_palette(name = "Darjeeling1"))  +
  geom_point(data = fake_dta, aes(x = y, col = groupe, y=ord), size = 2, alpha = 0.7) 
```



---
template: model
## Version régulière du modèle


---
template: model
## Version singulière du modèle


---
template: model
## Sous forme matricielle


---
template: model
## Déclinaisons sur les exemples


---
class: inverse
name: pause
# Pause

<br><br><br><br>
<p style="color:#B40F20;font-size:35px;text-align:center;">Prenons une petite pause !!!</p> 

---
# Etude des paramètres du modèle

## Estimation des paramètres du modèle version régulière

## Estimation des paramètres du modèle version singulière

## Estimation des paramètres du modèle version matricielle

## Estimation de la variance de l'erreur

## Distinction estimateur / estimations

## Loi des estimateurs 

## Loi des estimateurs sur les exemples

## Extension au modèle linéaire en général

## Déclnaisons sur les exemples


---
template: pause

---

# Test du modèle complet

## Test de l'existence d'un effet

## Hypothèses du test

## Déclinaison sur les exemples

## Loi de la statistique de test sous H0

## Déclinaison sur les exemples

# Test sur un paramètre

## Réflexion sur le sens de ce test

## loi de la statistique de test

## Déclinaisonsur les exemples


