<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Régression linéaire</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marie-Pierre Etienne" />
    <script src="libs/header-attrs-2.4/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link rel="stylesheet" href="mpe_pres.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Régression linéaire
## simple et multiple
### Marie-Pierre Etienne
### <a href="https://github.com/marieetienne" class="uri">https://github.com/marieetienne</a>
### 2020/09/11 (updated: 2020-10-08)

---











name: intro
# Introduction

---
template: intro
## Etude de la pollution au SO2

On a mesuré pour 41 villes américaines, la pollution au SO2 ainsi que la population dans la viille




```r
library(coursesdata)
data(usdata)
```

&lt;img src="regression_files/figure-html/usfata-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


--
&lt;p class="question"&gt; La taille d'une ville est elle lidée à la pollution en SO2 ?&lt;/p&gt;


---
template: intro
## Cadre général du modèle de régression simple

On étudie le lien entre  
- une variable quantitative notée `\(Y\)` (la fréquence cardiaque),
- et une variable quantitative `\(x\)`.

Les données peuvent être visualisées à l'aide d'un nuage de points.


--
&lt;p class="question"&gt; La variable x a-t-elle un effet sur la variable Y ?&lt;/p&gt;

---
name: model
# Le modèle de régression simple

---
template: model

## Graphiquement 

Une visualisation graphique du modèle d'analyse de la variance.

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;


Comment imagine-t-on le processus aléatoire qui a conduit à nos données ?




---






count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_04_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-reg_versiongraphique-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-reg_versiongraphique-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-reg_versiongraphique-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---





count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_04_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-reg_versiongraphique_M0-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-reg_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-reg_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;









---
template: model

Lequel de ces mécanismes est le plus crédible au vu des donées ?

&lt;img src="regression_files/figure-html/compare_model_graph-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
template: model

## Le modèle de régression simple 

`$$Y_{k} = \beta_0 +\beta_1 x_{k}  +E_{k},\quad E_{k}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2),$$`
avec 
- `\(x_k\)` la valeur de la variable explicative pour l'observation `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro d'individus, `\(n\)` le nombre total d'individus,
- `\(\beta_0\)` l'ordonnée à l'origine, 
- `\(\beta_1\)` la pente de la droite, mesure de l'effet de la variable `\(x\)`

- `\(\sigma^2\)` la variance.

### Une écriture équivalente 

`$$Y_{k} \overset{ind}{\sim}\mathcal{N}(\beta_0+\beta_1 x_k, \sigma^2).$$`


### Nombre de paramètres du modèle

- `\(2\)` paramètres de moyenne  `\((\beta_0, \beta_1)\)`; 
- 1 paramètre de variance `\(\sigma^2\)`

---
template: model

## Le modèle de régression simple sur l'exemple de la pollution.

`$$Y_{k} = \beta_0 +\beta_1 x_{k}  +E_{k},\quad E_{k}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2),$$`
avec 
- `\(x_k\)` la population dans la ville `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro de la ville, `\(n=41\)`,
- `\(\beta_0\)` l'ordonnée à l'origine, 
- `\(\beta_1\)` la pente de la droite, mesure de l'effet de la population sur la pollution.

- `\(\sigma^2\)` la variance.

### Nombre de paramètres du modèle
- 2 paramètres de moyennes
- 1 paramètre de variance


---
template: model
## Sous forme matricielle
 `$$\bf{Y = X\theta + E}$$`
### Forme régulière 

`$$Y=\begin{pmatrix}
Y_{1}\\
Y_{2}\\
\vdots\\
Y_{k}\\
\vdots\\
Y_{n}\end{pmatrix},
 \quad
{\bf{X}} =\overset{\color{gray}{\begin{matrix}\beta_0  &amp; \beta_1\end{matrix}}}{\begin{pmatrix}
1 &amp; x_1\\
1 &amp; x_2\\
\vdots &amp; \vdots\\
1 &amp; x_k\\
 \vdots &amp; \vdots\\
1 &amp; x_n\\
 \end{pmatrix}},\quad
{\bf{\theta}} =\begin{pmatrix}
\beta_0\\
\beta_1\\
\end{pmatrix}, \quad{\bf{E}} = \overset{}{\begin{pmatrix}
E_{1}\\
E_{2}\\
\vdots\\
E_{k}\\
\vdots\\
E_{n}\\
\end{pmatrix}}$$`
---
template: model

## Exercice

&lt;p class=question&gt; Détailler le modèle sous forme matricielle pour l'exemple de la pollution (écrire les 3 premières lignes de la matrice `\(X\)` )&lt;/p&gt;

--
Attention, la réponse est dans la slide qui suit !


---
template: model

## Correction 



```r
Mcomp &lt;- lm(SO2 ~ pop , data = usdata)
model.matrix(Mcomp) %&gt;% head(n = 3)
```

```
  (Intercept) pop
1           1 582
2           1 132
3           1 716
```
---
name: parametre
# Estimation des paramètres


---
template: parametre
## Estimation des paramètres du modèle version matricielle


Le modèle sous forme matricielle s'écrit

`$$\bf{Y = X\theta + E}.$$`
--

### Estimation de `\(\theta\)`

`$$\hat{\theta} = (X^\intercal X )^{-1} X^\intercal Y_{obs}.$$`

--

### Estimateur de `\(\theta\)`

`$$T = (X^\intercal X )^{-1} X^\intercal Y.$$`
--

### Loi de l'estimateur de `\(\theta\)`


`$$T  \sim \mathcal{N}_{I}\left(\theta, \sigma^2 (X^\intercal X )^{-1}\right).$$`

---
template: parametre
## Le paramètre de variance

La somme des carrés résiduelles s'écrit sous la forme 

`$$RSS = || Y- X \hat{\theta} ||^2$$`

### Estimateur de la variance 

  $$S^2 =\frac{1}{DF_{res}} RSS, $$
est un &lt;a class=care&gt; estimateur sans bias de  `\(\sigma^2\)` &lt;/a&gt; .

Dans le cas du modèle de régression simple  `\(DF_{res}=n-2\)` (n observations et 2 paramètres de moyennes à estimer, le nombre de composantes dans le vecteur `\(\theta\)`)

--

## Estimation de `\(\sigma^2\)`

`$$\hat{\sigma}^2 =\frac{1}{n-2} RSS_{obs}.$$`
---
template: parametre
## Vérifier l'estimation sur l'exemple de la pollution



```r
X &lt;- model.matrix(Mcomp)
XXprimemoinsUn &lt;- solve(t(X)%*%X)
XXprimemoinsUn %*% t(X) %*% matrix(usdata$SO2, ncol =1)
```

```
                   [,1]
(Intercept) 17.86831630
pop          0.02001359
```

```r
summary(Mcomp)$coefficients
```

```
               Estimate  Std. Error  t value     Pr(&gt;|t|)
(Intercept) 17.86831630 4.713843676 3.790604 0.0005093514
pop          0.02001359 0.005643813 3.546111 0.0010349968
```
--
Loi de l'estimateur


```r
summary(Mcomp)$sigma^2 * XXprimemoinsUn 
```

```
            (Intercept)           pop
(Intercept) 22.22032220 -1.938582e-02
pop         -0.01938582  3.185262e-05
```

```r
sqrt(diag(summary(Mcomp)$sigma^2 * XXprimemoinsUn ))
```

```
(Intercept)         pop 
4.713843676 0.005643813 
```


---
template: model

## Le modèle de régression multiple

Plusieurs variables sont potentiellement liées à la pollution enSO2


- temp : Average temperature in Fahrenheit
- manuf : No. of companies employing more than 20 employees
- pop : Population in thousands
- wind : Average annual wind speed in miles/hour
- precip : annual precipitation height in inches
- days : No. of days of precipitation


&lt;a class=question&gt; Quelles sont les variables liées à la pollution en SO2 ? &lt;/a&gt;

---
template: model

## Le modèle de régression multiple 

`$$Y_{k} = \beta_0 +\beta_1 x_{k}^{1}  + \beta_2 x_{k}^{2} + \ldots +  \beta_p x_{k}^{p}  +  E_{k},\quad E_{k}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2),$$`
avec 
- `\(x_{k}^{l}\)` la valeur de la variable explicative `\(l\)` pour l'observation `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro d'individus, `\(n\)` le nombre total d'individus,
- `\(\beta_0\)` l'ordonnée à l'origine, 
- `\(\beta_l\)` l'effet de la variable `\(X^{l}\)` sur la variable à expliquer,
- `\(\sigma^2\)` la variance.

### Une écriture équivalente 

`$$Y_{k} \overset{ind}{\sim}\mathcal{N}\beta_0 +\beta_1 x_{k}^{1}  + \beta_2 x_{k}^{2} + \ldots +  \beta_p x_{k}^{p} , \sigma^2).$$`


### Nombre de paramètres du modèle

- `\(l+1\)` paramètres de moyenne  `\((\beta_0, \beta_1, \ldots, \beta_l)\)`; 
- 1 paramètre de variance `\(\sigma^2\)`

---
template: model
## Sous forme matricielle
 `$$\bf{Y = X\theta + E}$$`
### Forme régulière 

`$$Y=\begin{pmatrix}
Y_{1}\\
Y_{2}\\
\vdots\\
Y_{k}\\
\vdots\\
Y_{n}\end{pmatrix},
 \quad
{\bf{X}} =\overset{\color{gray}{\begin{matrix}\beta_0  &amp;&amp; \beta_1&amp;&amp; \beta_2&amp;&amp;\ldots &amp;&amp;\beta_l\end{matrix}}}{\begin{pmatrix}
1 &amp; x_1^{1} &amp; x_1^{2} &amp; \ldots &amp;x_1^{l}\\
1 &amp; x_2^{1} &amp; x_2^{2} &amp; \ldots &amp;x_2^{l}\\
\vdots &amp; \vdots&amp; \vdots &amp;&amp; \vdots\\
1 &amp; x_k^{1} &amp; x_k^{2} &amp; \ldots &amp;x_k^{l}\\
 \vdots &amp; \vdots&amp; \vdots &amp;&amp; \vdots\\
1 &amp; x_n^{1} &amp; x_n^{2} &amp; \ldots &amp;x_n^{l}\\
 \end{pmatrix}},\quad
{\bf{\theta}} =\begin{pmatrix}
\beta_0\\
\beta_1\\
\beta_2\\
\vdots\\
\beta_l\\
\end{pmatrix}, \quad{\bf{E}} = \overset{}{\begin{pmatrix}
E_{1}\\
E_{2}\\
\vdots\\
E_{k}\\
\vdots\\
E_{n}\\
\end{pmatrix}}$$`

---
template: model

## Sur l'exemple de la pollution



```r
Mcomp &lt;- lm(SO2 ~ . - City , data = usdata) # toutes les variables sauf City
model.matrix(Mcomp) %&gt;% head(n = 3)
```

```
  (Intercept) temp manuf pop wind precip days
1           1 70.3   213 582  6.0   7.05   36
2           1 61.0    91 132  8.2  48.52  100
3           1 56.7   453 716  8.7  20.66   67
```
---
name: parametre
# Estimation des paramètres


---
template: parametre
## Estimation des paramètres du modèle version matricielle


Le modèle sous forme matricielle s'écrit

`$$\bf{Y = X\theta + E}.$$`
--

### Estimation de `\(\theta\)`

`$$\hat{\theta} = (X^\intercal X )^{-1} X^\intercal Y_{obs}.$$`

--

### Estimateur de `\(\theta\)`

`$$T = (X^\intercal X )^{-1} X^\intercal Y.$$`
--

### Loi de l'estimateur de `\(\theta\)`


`$$T  \sim \mathcal{N}_{I}\left(\theta, \sigma^2 (X^\intercal X )^{-1}\right).$$`

---
template: parametre
## Le paramètre de variance

La somme des carrés résiduelles s'écrit sous la forme 

`$$RSS = || Y- X \hat{\theta} ||^2$$`

### Estimateur de la variance 

  $$S^2 =\frac{1}{DF_{res}} RSS, $$
est un &lt;a class=care&gt; estimateur sans bias de  `\(\sigma^2\)` &lt;/a&gt; .

Dans le cas du modèle de régression simple  `\(DF_{res}=n-l-1\)` (n observations et 2 paramètres de moyennes à estimer, le nombre de composantes dans le vecteur `\(\theta\)`)

--

## Estimation de `\(\sigma^2\)`

`$$\hat{\sigma}^2 =\frac{1}{n-l-1} RSS_{obs}.$$`
---
template: parametre
## Vérifier l'estimation sur l'exemple de la pollution



```r
X &lt;- model.matrix(Mcomp)
XXprimemoinsUn &lt;- solve(t(X)%*%X)
XXprimemoinsUn %*% t(X) %*% matrix(usdata$SO2, ncol =1)
```

```
                    [,1]
(Intercept) 111.72848064
temp         -1.26794109
manuf         0.06491817
pop          -0.03927674
wind         -3.18136579
precip        0.51235896
days         -0.05205019
```

```r
summary(Mcomp)$coefficients
```

```
                Estimate  Std. Error   t value     Pr(&gt;|t|)
(Intercept) 111.72848064 47.31810073  2.361221 0.0240867374
temp         -1.26794109  0.62117952 -2.041183 0.0490557189
manuf         0.06491817  0.01574825  4.122245 0.0002277862
pop          -0.03927674  0.01513274 -2.595482 0.0138461970
wind         -3.18136579  1.81501910 -1.752800 0.0886503978
precip        0.51235896  0.36275507  1.412410 0.1669175999
days         -0.05205019  0.16201386 -0.321270 0.7499724652
```
--
Loi de l'estimateur


```r
sqrt(diag(summary(Mcomp)$sigma^2 * XXprimemoinsUn ))
```

```
(Intercept)        temp       manuf         pop        wind      precip 
47.31810073  0.62117952  0.01574825  0.01513274  1.81501910  0.36275507 
       days 
 0.16201386 
```


---
name: modcomp
# Test du modèle complet


---
template: modcomp
## Pollution 

&lt;p class="question"&gt; La pollution en SO2 dans les villes américaines est elles liées à l'une au moins des variables caractérisiques des villes ?&lt;/p&gt;


-- 

On va à la pêche ....

---
template: modcomp
## Sous forme de comparaison de modèle


&lt;img src="regression_files/figure-html/compare_model_graph2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

--
&lt;p class="question"&gt; Le modèle Mcomp est il plus pertinent que le modèle M0 ?&lt;/p&gt;



---
template: modcomp
## Hypothèses du test

On va donc opposer une hypothèse de travail `\(H_0\)` contre une hypothèse alternative `\(H_1\)`. `\(H_0\)` peut donc prendre différentes formes:


`$$\begin{align} 
H_0 &amp; =\left \lbrace \mbox{Auncune variable n'est liée à la pollution en SO2}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{pour tout p\geq 1, \beta_p =0   \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est équivalent à } M0 \right\rbrace.
\end{align}$$`


`\(H_1\)` prend les formes équivalentes suivantes

`$$\begin{align} 
H_1 &amp; =\left \lbrace \mbox{Au moins 1 variable est liée à la pollution en SO2}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{Il existe un } p, \beta_p \ne 0  \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est préférable à } M0 \right\rbrace.
\end{align}$$`

--

Sous `\(H_0\)`, 
`$$F= \frac{\frac{SS_{M_{comp}}}{l}}{\frac{RSS}{n-l-1}} \underset{H_0}{\sim}\mathcal{F}(l, n-l-1)$$`  

---
template: modcomp
## Loi de la statistique de test sous `\(H_0\)` - graphiquement

Sous `\(H_0\)` la loi de distribution de `\(F\)` est 






---

count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-pvalue_graphique-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---
name: variance_decomposition
# Decomposition de SSM

---
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le retangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`.


&lt;br&gt;


&lt;img src="./RSS1.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le retangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`.


&lt;br&gt;

&lt;img src="./RSS2.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le retangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`.


&lt;br&gt;

&lt;img src="./RSS3.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;
---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le retangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`.

&lt;br&gt;

&lt;img src="./RSS4.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le retangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`.


&lt;br&gt;

&lt;img src="./RSS5.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## Mathématiquement

On veut décomposer la variabilité attribuée au modèle selon les différentes sources.

Considérons les différents modèles possibles

`$$\begin{align}
M_0\ :\ Y_{ijk} &amp;= \mu + E_{ijk}\\
M_{1}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + E_{ijk}\\
M_{2}\ :\ Y_{ijk} &amp;= \mu + \beta_j + E_{ijk}\\
M_{12}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + \beta_j + E_{ijk}\\
M_{comp}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + \beta_j +\gamma_{ij} + E_{ijk}\\
\end{align}$$`

--

&lt;a class = question&gt; Comment mesurer l'effet des différents facteurs&lt;/a&gt; 

--

Mesurer la réduction de variabilité liée à la prise en compte d'un facteur.

---
template: variance_decomposition
## Réduction de variabilité

`$$\begin{align}
SSM &amp; = RSS_0 - RSS_{comp}\\
SSM &amp; = \underbrace{RSS_0 - RSS_{1}}_{R(\alpha\vert \mu )} + {RSS_1 - RSS_{12}} +{RSS_{12} - RSS_{comp}} \\
\end{align}$$`
--


&lt;img src="./RSS4_Ralpha.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;


---
count: false
template: variance_decomposition
## Réduction de variabilité

`$$\begin{align}
SSM &amp; = RSS_0 - RSS_{comp}\\
SSM &amp; = \underbrace{RSS_0 - RSS_{1}}_{R(\alpha\vert \mu )} + \underbrace{RSS_1 - RSS_{12}}_{R(\beta\vert\alpha,\mu)} + {RSS_{12} - RSS_{comp}} \\
\end{align}$$`



&lt;img src="./RSS4_Rbeta.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;



---
count: false
template: variance_decomposition
## Réduction de variabilité

`$$\begin{align}
SSM &amp; = RSS_0 - RSS_{comp}\\
SSM &amp; = \underbrace{RSS_0 - RSS_{1}}_{R(\alpha\vert \mu )} + \underbrace{RSS_1 - RSS_{12}}_{R(\beta\vert\alpha,\mu)} + \underbrace{RSS_{12} - RSS_{comp}}_{R(\gamma\vert \beta, \alpha, \mu)} \\
\end{align}$$`



&lt;img src="./RSS4.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;



---
template: variance_decomposition
## Test de type 1


 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Source&lt;/th&gt;
    &lt;th&gt;H0&lt;/th&gt;
    &lt;th&gt;SS&lt;/th&gt;
    &lt;th&gt;Df&lt;/th&gt;
    &lt;th&gt;F&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;th&gt; Fact1 &lt;/th&gt;
    &lt;th&gt; M0 et M1 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\alpha\vert \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(I-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\alpha\vert \mu)}{I-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; Fact2 &lt;/th&gt;
    &lt;th&gt; M1 et M12 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\beta\vert\alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(J-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\beta\vert \alpha, \mu)}{J-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; Inter &lt;/th&gt;
    &lt;th&gt; M12 et Mcomp sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\gamma\vert \beta, \alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\((J-1)(J-1)\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\gamma\vert \beta, \alpha, \mu)}{(I-1)(J-1)}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;/table&gt; 




---
template: variance_decomposition
## Tests de type 1

Rôle asymétrique des facteurs (l'ordre des facteurs importe).

--

## Tests de type 2

But : symétriser le rôle des différents facteurs

&lt;img src="./RSS5.png" width="45%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## Test de type 2

 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Source&lt;/th&gt;
    &lt;th&gt;H0&lt;/th&gt;
    &lt;th&gt;SS&lt;/th&gt;
    &lt;th&gt;Df&lt;/th&gt;
    &lt;th&gt;F&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;th&gt; Fact1 &lt;/th&gt;
    &lt;th&gt; M2 et M12 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\alpha\vert \beta, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(I-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\alpha\vert\beta, \mu)}{I-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; Fact2 &lt;/th&gt;
    &lt;th&gt; M1 et M12 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\beta\vert\alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(J-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\beta\vert \alpha, \mu)}{J-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; Inter &lt;/th&gt;
    &lt;th&gt; M12 et Mcomp sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\gamma\vert \beta, \alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\((J-1)(J-1)\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\gamma\vert \beta, \alpha, \mu)}{(I-1)(J-1)}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;/table&gt; 

---
template: variance_decomposition
## L'exemple des fréquence cardiaque

### Type 1

```r
MComp &lt;- lm(freqC ~ Sexe + Sport_Fact +Sexe:Sport_Fact, data = freqdata)
anova(MComp)
```

```
Analysis of Variance Table

Response: freqC
                Df Sum Sq Mean Sq F value    Pr(&gt;F)    
Sexe             1   0.63   0.625  0.2308  0.634439    
Sport_Fact       4 483.90 120.975 44.6677 3.207e-12 ***
Sexe:Sport_Fact  4  54.00  13.500  4.9846  0.003347 ** 
Residuals       30  81.25   2.708                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

--
### Type 2


```r
library(car)
Anova(MComp, type = 2)
```

```
Anova Table (Type II tests)

Response: freqC
                Sum Sq Df F value    Pr(&gt;F)    
Sexe              0.63  1  0.2308  0.634439    
Sport_Fact      483.90  4 44.6677 3.207e-12 ***
Sexe:Sport_Fact  54.00  4  4.9846  0.003347 ** 
Residuals        81.25 30                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
template: variance_decomposition
## L'exemple des fréquence cardiaque

Il s'agit du cas particulier `\(n_{ij}\)` sont tous égaux. Le plan d'expérience est dit **équilibré**.

--


&lt;img src="./RSS3_eq.png" width="45%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## Fréquence cardiaque, plan d'expérience déséquilibré


```r
table(freqdata_des$Sexe, freqdata_des$Sport)
```

```
   
    1 2 3 4 5
  F 6 3 5 3 2
  M 3 2 6 5 5
```

```r
anova(MComp)
```

```
Analysis of Variance Table

Response: freqC
                Df Sum Sq Mean Sq F value    Pr(&gt;F)    
Sexe             1  46.88  46.881  28.129 9.882e-06 ***
Sport_Fact       4 461.77 115.441  69.265 1.025e-14 ***
Sexe:Sport_Fact  4  69.73  17.432  10.459 1.995e-05 ***
Residuals       30  50.00   1.667                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

```r
Anova(MComp, type = 2)
```

```
Anova Table (Type II tests)

Response: freqC
                Sum Sq Df F value    Pr(&gt;F)    
Sexe              1.14  1  0.6857    0.4142    
Sport_Fact      461.77  4 69.2648 1.025e-14 ***
Sexe:Sport_Fact  69.73  4 10.4593 1.995e-05 ***
Residuals        50.00 30                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```



---
template: variance_decomposition
## Exercice

Indiquer dans chaque portion du schéma ci-dessous, le somme des carrés représentés. 


&lt;img src="./RSS3.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
template: pause

---
name: comp_moyenne
# Comparaison des différents groupes
---
template: comp_moyenne

## Question 

&lt;a class=question&gt; Quels sont les niveaux de pratiques sportives correspondant à des fréquences cardiaques différentes ?&lt;/a&gt;

--

Calcul des moyennes par niveau de pratique sportive


```
[90m# A tibble: 5 x 2[39m
  Sport     m
  [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m     1  80.6
[90m2[39m     2  81.8
[90m3[39m     3  85.4
[90m4[39m     4  85.4
[90m# … with 1 more row[39m
```


Calcul des moyennes par sexe


```
[90m# A tibble: 2 x 2[39m
  Sexe      m
  [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m F      83.7
[90m2[39m M      85.9
```


--
&lt;a style=care&gt; Attention : &lt;/a&gt; comparaison de femmes sportives avec des hommes sédentaires

Plan d'expérience


```
   
    1 2 3 4 5
  F 6 3 5 3 2
  M 3 2 6 5 5
```



---
template: comp_moyenne

La moyenne au sein du groupe `\(i\)` pour le facteur est 1 est donnée par :
`$$Y_{i..} = \frac{1}{n_{i+}}\sum_{j=1}^J \sum_{k=1}^{n_ij}Y_{ijk},$$`
avec `\(n_{i+}=\sum_j n_{ij},\)` le nombre total d'observations pour le niveau `\(i\)`. 

Alors `$$\mathbb{E}(Y_{i..} )= \mu + \alpha_i  + \frac{1}{n_{i+}}\sum_{j=1}^J  n_{ij} (\beta_j  +\gamma_{ij}).$$`

--
Sur notre exemple
`$$\mathbb{E}(Y_{1..} )= \mu  + \alpha_1 + \frac{1}{n_{i+}} \left( 6 (\beta_1 + \gamma_{11}) + 3 (\beta_2 + \gamma_{12})  + 5 (\beta_3 + \gamma_{13}) + 3 (\beta_4 + \gamma_{14})+ 2 (\beta_5 + \gamma_{15})\right).$$`

`$$\mathbb{E}(Y_{2..} )= \mu  + \alpha_2 + \frac{1}{n_{i+}} \left( 3 (\beta_1 + \gamma_{21}) + 2 (\beta_2 + \gamma_{22})  + 6 (\beta_3 + \gamma_{23}) + 5 (\beta_4 + \gamma_{24})+ 5 (\beta_5 + \gamma_{25})\right).$$`

--

`$$\begin{align}
\mathbb{E}(Y_{1..} - Y_{2..} )= &amp; \alpha_1- \alpha_2 + \frac{1}{n_{i+}} \left( 3 \beta_1  + 6\gamma_{11}  - 3\gamma_{21} +\beta_2 + 3\gamma_{12}  - 2\gamma_{22} - \beta_3 +5\gamma_{13}  - 6\gamma_{23}\right. \\
&amp; \left. -2\beta_4 + 3 \gamma_{14}  -  5\gamma_{24} -3 \beta_5 + 2 \gamma_{15} -5 \gamma_{25} \right).
\end{align}$$`

Les effets potentiels de la pratique sportive n'interviennent pas de la même manière dans les deux moyennes.


---
template: comp_moyenne
## Moyennes ajustées

C'est la moyenne qu'on observerait dans un plan d'expérience équilibré

`$$\tilde{\mu}_{i.} = \mu + \alpha_i + \frac{1}{J}\sum_{j=1}^J (\beta_j +\gamma_{ij}).$$`
`$$\tilde{\mu}_{.j} = \mu + \beta_j + \frac{1}{I}\sum_{i=1}^I (\alpha_i +\gamma_{ij}).$$`


*On redresse artificiellement le plan d'expérience*
--

`$$\tilde{\mu}_{1.}-\tilde{\mu}_{2.} =  \alpha_1  -\alpha_{2}+ \frac{1}{J}\sum_{j=1}^J (\gamma_{1j} -\gamma_{2j}).$$`

---
template: comp_moyenne

## Moyennes ajustées pour le sexe


```r
library(emmeans)
m_ajust_sexe &lt;- emmeans(MComp, "Sexe")
pairs(m_ajust_sexe)
```

```
 contrast estimate    SE df t.ratio p.value
 F - M       0.373 0.442 30 0.844   0.4052 

Results are averaged over the levels of: Sport_Fact 
```

```r
plot(m_ajust_sexe)
```

&lt;img src="regression_files/figure-html/moy_ajustees-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---

template: comp_moyenne
## Moyennes ajustées pour le sport


```r
m_ajust_sport &lt;- emmeans(MComp, "Sport_Fact")
summary(pairs(m_ajust_sport))
```

```
 contrast estimate    SE df t.ratio p.value
 1 - 2      -1.000 0.745 30  -1.342 0.6681 
 1 - 3      -4.667 0.601 30  -7.766 &lt;.0001 
 1 - 4      -4.933 0.656 30  -7.518 &lt;.0001 
 1 - 5     -11.300 0.707 30 -15.981 &lt;.0001 
 2 - 3      -3.667 0.707 30  -5.185 0.0001 
 2 - 4      -3.933 0.755 30  -5.212 0.0001 
 2 - 5     -10.300 0.799 30 -12.886 &lt;.0001 
 3 - 4      -0.267 0.612 30  -0.435 0.9921 
 3 - 5      -6.633 0.667 30  -9.950 &lt;.0001 
 4 - 5      -6.367 0.717 30  -8.881 &lt;.0001 

Results are averaged over the levels of: Sexe 
P value adjustment: tukey method for comparing a family of 5 estimates 
```

---

template: comp_moyenne
## Moyennes ajustées pour le sport

&lt;img src="regression_files/figure-html/ajuste_sport_graph-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../resources/collapseoutput.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url(img/sticker_sotr.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  bottom: 1em;
  right: 1em;
  width: 66px;
  height: 78px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
